{% extends "base.html" %}

{% block title %}
Classificador de Emails com IA
{% endblock %}

{% block header %}
  {% include "partials/header.html" %}
{% endblock %}

{% block content %}

  <section
    id="email-classifier"
    class="mx-auto max-w-2xl"
  >

    <!-- Input Section -->
    <section
      id="input-section"
      class="card-elevated p-6 space-y-6"
      aria-labelledby="input-heading"
    >
      <header>
        <h2
          id="input-heading"
          class="text-lg font-semibold text-foreground"
        >
          Enviar Email para Classificação
        </h2>
        <p class="text-sm text-muted-foreground mt-1">
          Escolha uma forma de enviar o conteúdo do email
        </p>
      </header>



      <!-- Formulário -->
      <form
        id="email-form"
        hx-post="/api/process-email"
        hx-target="#results-section"
        hx-swap="innerHTML"
        enctype="multipart/form-data"
        class="space-y-6"
      >
        {# O wrapper abaixo é trocado pelo HTMX e contém tanto os botões de toggle quanto a área de input #}
        {% include "partials/input_wrapper.html" %}

        {% include "partials/process_button.html" %}
      </form>
    </section>

    <!-- Results Section (htmx target) -->
    <section
      id="results-section"
      class="mt-6 card-elevated p-6 hidden"
      aria-live="polite"
    >
      {# Conteúdo dinâmico aqui #}
    </section>

    <!-- Template de Loading (para ser injetado via JS) -->
    <template id="loading-template">
      {% include "partials/loading_state.html" %}
    </template>

    {% include "partials/footer_info.html" %}

  </section>

  <script>
    document.body.addEventListener('htmx:beforeRequest', function(evt) {
      if (evt.target.id === 'email-form') {
        const resultsSection = document.getElementById('results-section');
        const loadingTemplate = document.getElementById('loading-template');
        
        resultsSection.innerHTML = loadingTemplate.innerHTML;
        resultsSection.classList.remove('hidden');
      }
    });

    document.body.addEventListener('htmx:beforeSwap', function(evt) {
      // Allow 400 and 500 errors to swap content (display error message)
      if (evt.detail.xhr.status === 400 || evt.detail.xhr.status === 500) {
        evt.detail.shouldSwap = true;
        evt.detail.isError = false; // Prevent htmx:responseError from firing (suppress generic toast)
      }
    });
  </script>

{% endblock %}
