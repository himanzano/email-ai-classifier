<div class="space-y-3">
  <label class="text-sm font-medium text-foreground">
    Upload de Arquivo
  </label>

  <!-- File Info Card (Hidden by default) -->
    <div id="file-info" class="mt-2 hidden w-full animate-fade-in relative z-20">
      <div class="flex items-center gap-3 p-4 rounded-lg border border-border bg-card">
        <div class="flex items-center justify-center w-10 h-10 rounded-lg bg-primary/10">
          <svg xmlns="http://www.w3.org/2000/svg" width="24" height="24" viewBox="0 0 24 24" fill="none" stroke="currentColor"
            stroke-width="2" stroke-linecap="round" stroke-linejoin="round"
            class="w-5 h-5 text-primary lucide lucide-file-icon lucide-file">
            <path
              d="M6 22a2 2 0 0 1-2-2V4a2 2 0 0 1 2-2h8a2.4 2.4 0 0 1 1.704.706l3.588 3.588A2.4 2.4 0 0 1 20 8v12a2 2 0 0 1-2 2z" />
            <path d="M14 2v5a1 1 0 0 0 1 1h5" />
          </svg>
        </div>
        <div class="flex-1 min-w-0">
          <p id="file-name" class="text-sm font-medium text-foreground truncate"></p>
          <p id="file-size" class="text-xs text-muted-foreground"></p>
        </div>
        <button type="button" id="remove-file"
          class="p-2 rounded-md text-muted-foreground hover:text-foreground hover:bg-secondary transition-colors"
          aria-label="Remover arquivo">
          <svg xmlns="http://www.w3.org/2000/svg" width="24" height="24" viewBox="0 0 24 24" fill="none" stroke="currentColor"
            stroke-width="2" stroke-linecap="round" stroke-linejoin="round" class="w-4 h-4 lucide lucide-x-icon lucide-x">
            <path d="M18 6 6 18" />
            <path d="m6 6 12 12" />
          </svg>
        </button>
      </div>
    </div>
    
  <!-- Upload area -->
  <div
    id="upload-ui-wrapper" 
    class="
      relative flex flex-col items-center justify-center gap-3 p-8 rounded-lg
      border-2 border-dashed border-border bg-secondary/30
      hover:border-primary/40 hover:bg-secondary/50
      transition-all duration-200 mt-2
    "
  >
    <input
      type="file"
      id="file"
      name="file"
      accept=".txt,.pdf"
      class="absolute inset-0 w-full h-full opacity-0 cursor-pointer disabled:cursor-not-allowed"
      aria-describedby="file-upload-hint"
    />

    <!-- Upload UI Wrapper (to be hidden when file is selected) -->
    <div class="flex flex-col items-center gap-3">
      <!-- Upload icon -->
      <div class="flex items-center justify-center w-12 h-12 rounded-full bg-primary/10">
        <svg xmlns="http://www.w3.org/2000/svg" width="24" height="24" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round" class="w-6 h-6 text-primary lucide lucide-upload-icon lucide-upload" aria-hidden="true"><path d="M12 3v12"/><path d="m17 8-5-5-5 5"/><path d="M21 15v4a2 2 0 0 1-2 2H5a2 2 0 0 1-2-2v-4"/></svg>
      </div>

      <div class="text-center" id="upload-prompt">
        <p class="text-sm font-medium text-foreground">
          Arraste um arquivo ou
          <span class="text-primary">clique para selecionar</span>
        </p>
        <p
          id="file-upload-hint"
          class="text-xs text-muted-foreground mt-1"
        >
          Formatos aceitos: .txt, .pdf (máx. 5MB)
        </p>
      </div>
    </div>
  </div>

  <!-- Error message (renderizado pelo backend, se houver) -->
  {% if error %}
    <div class="flex items-center gap-2 p-3 rounded-lg bg-destructive/10 text-destructive text-sm">
      <svg xmlns="http://www.w3.org/2000/svg" width="24" height="24" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round" class="lucide lucide-circle-alert-icon lucide-circle-alert w-4 h-4 shrink-0"><circle cx="12" cy="12" r="10"/><line x1="12" x2="12" y1="8" y2="12"/><line x1="12" x2="12.01" y1="16" y2="16"/></svg>
      <span>{{ error }}</span>
    </div>
  {% endif %}
</div>

<script>
  (function() {
    const fileInput = document.getElementById('file');
    const uploadUiWrapper = document.getElementById('upload-ui-wrapper');
    const fileInfo = document.getElementById('file-info');
    const fileName = document.getElementById('file-name');
    const fileSize = document.getElementById('file-size');
    const removeBtn = document.getElementById('remove-file');

    function formatFileSize(bytes) {
      if (bytes === 0) return '0 Bytes';
      const k = 1024;
      const sizes = ['Bytes', 'KB', 'MB', 'GB'];
      const i = Math.floor(Math.log(bytes) / Math.log(k));
      return parseFloat((bytes / Math.pow(k, i)).toFixed(2)) + ' ' + sizes[i];
    }

    if (fileInput) {
      fileInput.addEventListener('change', function(e) {
        if (this.files && this.files[0]) {
          const file = this.files[0];
          fileName.textContent = file.name;
          fileSize.textContent = formatFileSize(file.size);
          
          uploadUiWrapper.classList.add('hidden');
          fileInfo.classList.remove('hidden');
          fileInput.classList.add('pointer-events-none');
        }
      });
    }

    if (removeBtn) {
      removeBtn.addEventListener('click', function(e) {
        e.preventDefault();
        e.stopPropagation();
        fileInput.value = '';
        
        // Disparar evento de mudança manualmente para atualizar o estado do botão de processamento
        const event = new Event('change', { bubbles: true });
        fileInput.dispatchEvent(event);

        uploadUiWrapper.classList.remove('hidden');
        fileInfo.classList.add('hidden');
        fileInput.classList.remove('pointer-events-none');
      });
    }
  })();
</script>
